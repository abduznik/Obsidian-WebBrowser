{"code":"import { Plugin, MarkdownView, Modal, Setting } from \"obsidian\";\nclass WebButtonModal extends Modal {\n    constructor(app, onSubmit) {\n        super(app);\n        this.buttons = [];\n        this.width = \"100%\";\n        this.height = \"500px\";\n        this.btnSize = \"medium\"; // small, medium, large\n        this.defaultColor = \"#007bff\";\n        this.onSubmit = onSubmit;\n    }\n    onOpen() {\n        const { contentEl } = this;\n        contentEl.empty();\n        contentEl.createEl(\"h2\", { text: \"Create Web Button Block\" });\n        // Container for buttons list\n        this.btnListEl = contentEl.createDiv({ cls: \"webblock-modal-buttons-list\" });\n        this.renderButtons();\n        // Button to add new button\n        const addBtn = contentEl.createEl(\"button\", { text: \"Add Button\" });\n        addBtn.onclick = () => {\n            this.buttons.push({ label: \"\", url: \"\", color: \"\" });\n            this.renderButtons();\n        };\n        // Width input\n        new Setting(contentEl)\n            .setName(\"Iframe Width\")\n            .setDesc(\"e.g. 100%, 800px\")\n            .addText(text => text\n            .setPlaceholder(\"100%\")\n            .setValue(this.width)\n            .onChange(value => this.width = value.trim() || \"100%\"));\n        // Height input\n        new Setting(contentEl)\n            .setName(\"Iframe Height\")\n            .setDesc(\"e.g. 500px, 50vh\")\n            .addText(text => text\n            .setPlaceholder(\"500px\")\n            .setValue(this.height)\n            .onChange(value => this.height = value.trim() || \"500px\"));\n        // Button size dropdown\n        new Setting(contentEl)\n            .setName(\"Button Size\")\n            .setDesc(\"Controls padding and font-size\")\n            .addDropdown(drop => drop\n            .addOption(\"small\", \"Small\")\n            .addOption(\"medium\", \"Medium (default)\")\n            .addOption(\"large\", \"Large\")\n            .setValue(this.btnSize)\n            .onChange(value => this.btnSize = value));\n        // Default button color input\n        new Setting(contentEl)\n            .setName(\"Default Button Color\")\n            .setDesc(\"Used if button has no color set\")\n            .addText(text => text\n            .setPlaceholder(\"#007bff\")\n            .setValue(this.defaultColor)\n            .onChange(value => this.defaultColor = value.trim() || \"#007bff\"));\n        // Submit button\n        const submitBtn = contentEl.createEl(\"button\", { text: \"Insert Block\" });\n        submitBtn.style.marginTop = \"1em\";\n        submitBtn.onclick = () => {\n            // Process buttons, replacing empty labels with 'none'\n            const processed = this.buttons.map(b => {\n                let url = b.url.trim();\n                if (url && !url.match(/^https?:\\/\\//i)) {\n                    url = \"https://\" + url;\n                }\n                const label = b.label.trim() || \"none\";\n                return { label, url, color: b.color };\n            });\n            this.close();\n            this.onSubmit(processed, this.width, this.height, this.btnSize, this.defaultColor);\n        };\n    }\n    renderButtons() {\n        this.btnListEl.empty();\n        this.buttons.forEach((btn, idx) => {\n            const row = this.btnListEl.createDiv({ cls: \"webblock-modal-btn-row\" });\n            row.style.display = \"flex\";\n            row.style.gap = \"0.5em\";\n            row.style.marginBottom = \"0.5em\";\n            // Label input\n            const labelInput = row.createEl(\"input\", { type: \"text\", placeholder: \"Label\", value: btn.label });\n            labelInput.style.flex = \"1\";\n            labelInput.oninput = e => {\n                this.buttons[idx].label = e.target.value;\n            };\n            // URL input\n            const urlInput = row.createEl(\"input\", { type: \"text\", placeholder: \"URL\", value: btn.url });\n            urlInput.style.flex = \"2\";\n            urlInput.oninput = e => {\n                this.buttons[idx].url = e.target.value;\n            };\n            // Color input\n            const colorInput = row.createEl(\"input\", { type: \"color\", value: btn.color || \"#000000\" });\n            colorInput.style.width = \"40px\";\n            colorInput.oninput = e => {\n                this.buttons[idx].color = e.target.value;\n            };\n            // Remove button\n            const removeBtn = row.createEl(\"button\", { text: \"Ã—\" });\n            removeBtn.style.width = \"25px\";\n            removeBtn.onclick = () => {\n                this.buttons.splice(idx, 1);\n                this.renderButtons();\n            };\n        });\n    }\n}\nexport default class WebBlockPlugin extends Plugin {\n    async onload() {\n        this.addCommand({\n            id: \"insert-web-button-block\",\n            name: \"Insert Web Button Block\",\n            callback: () => {\n                new WebButtonModal(this.app, (buttons, width, height, btnSize, defaultColor) => {\n                    const buttonsJson = JSON.stringify(buttons, null, 2);\n                    const snippet = `\\`\\`\\`webblock\r\n${buttonsJson}\r\nwidth=${width}\r\nheight=${height}\r\nbuttonSize=${btnSize}\r\ndefaultColor=${defaultColor}\r\n\\`\\`\\``;\n                    const view = this.app.workspace.getActiveViewOfType(MarkdownView);\n                    if (!view)\n                        return;\n                    view.editor.replaceRange(snippet, view.editor.getCursor());\n                }).open();\n            }\n        });\n        this.registerMarkdownCodeBlockProcessor(\"webblock\", (source, el) => {\n            try {\n                const lines = source.trim().split(\"\\n\");\n                // Parse optional settings lines\n                const width = lines.find(l => l.startsWith(\"width=\"))?.split(\"=\")[1] ?? \"100%\";\n                const height = lines.find(l => l.startsWith(\"height=\"))?.split(\"=\")[1] ?? \"500px\";\n                const buttonSize = lines.find(l => l.startsWith(\"buttonSize=\"))?.split(\"=\")[1] ?? \"medium\";\n                const defaultColor = lines.find(l => l.startsWith(\"defaultColor=\"))?.split(\"=\")[1] ?? \"#007bff\";\n                // JSON lines = all except settings lines\n                const jsonLines = lines.filter(l => !l.startsWith(\"width=\") && !l.startsWith(\"height=\") && !l.startsWith(\"buttonSize=\") && !l.startsWith(\"defaultColor=\"));\n                const jsonStr = jsonLines.join(\"\\n\");\n                const buttons = JSON.parse(jsonStr);\n                // Container for buttons\n                const buttonContainer = el.createDiv();\n                buttonContainer.style.display = \"flex\";\n                buttonContainer.style.flexWrap = \"wrap\";\n                buttonContainer.style.gap = \"10px\";\n                buttonContainer.style.marginBottom = \"10px\";\n                // Define button size styles\n                const sizeStyles = {\n                    small: \"padding:4px 8px; font-size:0.75rem;\",\n                    medium: \"padding:8px 16px; font-size:1rem;\",\n                    large: \"padding:12px 24px; font-size:1.25rem;\"\n                };\n                // Create iframe\n                const iframe = el.createEl(\"iframe\", {\n                    attr: {\n                        style: `width: ${width}; height: ${height}; border: 1px solid #ccc;`,\n                    }\n                });\n                for (const btn of buttons) {\n                    const button = buttonContainer.createEl(\"button\", { text: btn.label });\n                    button.style.cssText = sizeStyles[buttonSize] + ` background-color: ${btn.color ?? defaultColor}; color: white; border:none; border-radius:4px; cursor:pointer;`;\n                    button.onclick = () => {\n                        iframe.setAttr(\"src\", btn.url);\n                    };\n                }\n            }\n            catch (e) {\n                el.createEl(\"pre\", { text: \"Invalid webblock format:\\n\" + String(e) });\n            }\n        });\n    }\n}\n","references":["C:/Users/Yan/Documents/GitHub/Obsidian-WebBrowser/node_modules/obsidian/obsidian.d.ts"]}
